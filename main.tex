\documentclass[12pt]{article}
\usepackage{amsmath}
\usepackage{fontspec}
\usepackage[a4paper, hmargin={2cm, 2cm}, vmargin={2cm, 2cm}]{geometry}
\usepackage{hyperref}
\usepackage{hyphenat}
\usepackage{lipsum}
\usepackage{polyglossia}
\usepackage{setspace}
\usepackage{tabularx}
\usepackage{xcolor}

\setmainlanguage{russian}
\setmainfont{CMU Serif}
\newfontfamily{\cyrillicfonttt}{Courier New}
\onehalfspace
\hypersetup{
    bookmarks,
    colorlinks=true,
    urlcolor=blue,
    linkcolor=blue,
}
\newcommand{\myTitle}{Экологический чат-бот}
\newcommand{\mySubtitle}{Техническое задание на создание чат-бота в Telegram}
\newcommand{\isDraft}{1}
\title{\myTitle}
\author{}

\newcommand{\sectionBreaksNone}{\relax}
\newcommand{\sectionBreaksTerse}{\vspace{1cm}}
\newcommand{\sectionBreaksPage}{\newpage}
\newcommand{\sectionBreaks}{\sectionBreaksTerse}

\let\origSection\section
\renewcommand{\section}{\sectionBreaks\origSection}

\setlength{\emergencystretch}{3em}

\newcommand{\todo}[1]{\textcolor{red}{\textbf{TODO}}: #1}
\newcommand{\inlinetodo}[1]{(\emph{\textcolor{red}{\textbf{TODO}}: #1})}

\begin{document}

\input{src/title-page.tex}
\newpage

\tableofcontents
\newpage

\section{Введение}
    \label{sec:intro}
    Программа <<Экологический чат-бот>> предназначена для информирования клиентов (сотрудников и студентов
    НИУ ВШЭ, а также других лиц) об экологической повестке внутри НИУ ВШЭ. Данный чат-бот предполагает
    пользовательское взаимодействие через мессенджер Telegram\footnote{\url{https://telegram.org}}.
    Основанием для разработки данного чат-бота является \inlinetodo{документ}.

\section{Требования к программе}
    \label{sec:req}
    \subsection{Требования к функциональности}
        \label{sec:req:fn}
        Чат-бот должен поддерживать следующие функции:
        \begin{enumerate}
            \item
                Доступ пользователей к внутренней базе знаний
            \item
                Редактирование базы знаний пользователями, наделёнными на это правом
            \item
                Рассылка новостей, связанных с экологической повесткой, подписавшимся на рассылку
                пользователям
            \item
                Автоматический сбор новостей с интернет-ресурсов для их дальнейшей рассылки
        \end{enumerate}

        \subsubsection{База знаний}
            \label{sec:req:fn:kb}
            Внутренняя база знаний представляет из себя иерархическую систему из разделов
            и заметок. Вне зависимости от наполнения базы знаний информацией, в ней существует единственный
            корневой раздел, не имеющий имени. Каждый раздел, не являющийся корневым, а также
            каждая заметка принадлежат тому или иному разделу (в том числе корневому). Циклическая
            принадлежность разделов (например, раздел \(A\) принадлежит разделу \(B\), который, в свою
            очередь, принадлежит разделу \(A\)) запрещена; также никакой раздел не может принадлежать самому
            себе. Корневой раздел не принадлежит никакому разделу. Таким образом, разделы, заметки и отношение
            принадлежности образуют иерархическую структуру --- дерево разделов. Эта структура напоминает
            дерево файлов и папок в файловой системе. Схематичное изображение примера дерева разделов
            показано на рис.~\ref{fig:req:fn:kb:tree}.
            \begin{figure}[h]
                \centering
                \begingroup
                \newcommand{\name}{\rmfamily\,}
                \begin{tabular}{>{\ttfamily}l}
                    \name Корневой раздел \\
                    +---\name Раздел «Экология в Вышке» \\
                    |~~~+---\name Раздел «Переработка отходов» \\
                    |~~~|~~~+---\name Заметка «Раздельный сбор мусора» \\
                    |~~~|~~~+---\name Заметка «Места сбора батареек» \\
                    |~~~+---\name Заметка «Планы развития» \\
                    +---\name Раздел «О боте» \\
                    |~~~+---\name Заметка «Справка» \\
                    +---\name Заметка «Основная информация» \\
                \end{tabular}
                \endgroup
                \caption{Пример дерева разделов.}
                \label{fig:req:fn:kb:tree}
            \end{figure}

            Каждый не-корневой раздел имеет имя. Каждая заметка имеет имя и содержимое.
            Именем явлется строка символов Юникода, поддерживаемых мессенджером, длиной
            не более 300~символов. У разделов и заметок, непосредственно принадлежащих одному и тому же
            разделу, имена должны различаться. Таким образом, запрещено наличие в одном разделе
            (а) двух разделов, (б) двух заметок и (в) раздела и заметки с одинаковыми именами.

            Содержимое каждой заметки является текстом длиной не более 3500~символов, а также может содержать
            не более 10~вложений. Каждое вложение --- это либо изображение разрешением не больше
            \(1920 \times 1080\)~пикселей, либо видео размером не более 50~МБ\footnote{
                Здесь и далее подразумеваются двоичные единицы измерения: \(1~\text{МБ} = 1024~\text{КБ}
                = 1048576~\text{Б}\).
            }, либо файл размером не более 50~МБ. Текст и вложения должны быть доступны пользователю
            через стандартные средства мессенджера. Допускается отправка текста и вложений
            отдельными соседними сообщениями.

            Навигация и просмотр базы знаний доступны всем пользователям.
            Пользователи, имеющие на это право, могут также редактировать базу знаний.
            Способ навигации по базе знаний, просмотра заметок и редактирования базы знаний
            описан в разделе \ref{sec:req:ui}.
            Правила определения пользователей, имеющих право на редактирование, описаны в разделе
            \ref{sec:req:sec}.

        \subsubsection{Сбор новостей}
            \label{sec:req:fn:grabnews}
            Не реже, чем один раз в день, бот совершает запросы на Интернет-ресурсы с целью получения с них
            новостей, связанных с экологической повесткой. Перечень собираемой информации:
            \begin{enumerate}
                \item
                    Загловок новости
                \item
                    Текст новости
                \item
                    Прямая ссылка на источник новости (ресурс, с которого новость получена)
                \item
                    Автор новости (если указан)
                \item
                    Дата публикации (если указана)
            \end{enumerate}

            Данная операция происходит автоматически, без участия человека. При невозможности сбора данных
            с одного или нескольких ресурсов по той или иной причине бот посылает сервисное уведомление
            с описанием ошибки, а также записывает информацию об ошибке в системный журнал.

            При риске возникновения препятствий к автоматическому сбору новостей (например, CAPTCHA-проверок)
            или если правила пользования ресурса, с которого собирается информация, запрещает автоматизированный
            доступ к новостям, допускается брать новости из RSS-ленты соответствующего ресурса при её наличии.
            В таком случае, допускается не получать полный текст новости, сохраняя лишь заголовок,
            ссылку на источник и иную информацию при её наличии.

            Полученные новости сохраняются во внутреннюю базу данных бота и потом используются для новостных
            рассылок, описанных в разделе \ref{sec:req:fn:newsletter}.

            \todo{Перечень ресурсов, с которых необходимо собирать новости.}

        \subsubsection{Новостная рассылка}
            \label{sec:req:fn:newsletter}
            Один раз в сутки \inlinetodo{возможно, стоит дать пользователю возможность настройки?} бот
            должен рассылать всем пользователям, подписанным на новостную рассылку, новости с внешних
            ресурсов, которые были собраны за этот день. Пользователю
            должна выводиться вся информация, сохранённая в базе данных, перечисленная в разделе
            \ref{sec:req:fn:grabnews}. Если текст новости длиннее 3500~символов или не помещается в
            стандартное сообщение мессенджера, допускается приводить только его начало, указывая,
            что по ссылке на источник откроется полный текст новости.

            Каждая новость присылается одним сообщением, не содержит вложений и
            должна быть маркирована хэштегом \hbox{\texttt{\#новость}}.

            Пользователям, не подписанным на новостную рассылку на момент её проведения, не должны
            рассылаться новостные сообщения.

            Бот не должен присылать сообщения с новостями пользователям, которые в данный момент находятся
            в интерактивном состоянии (см. раздел \ref{seq:req:ui:states}),
            однако он может уведомить их о том, что новостная рассылка для них готова.
            После выхода пользователя из интерактивного состояния бот должен повторить попытку
            рассылки не ранее, чем через 30~секунд, но не позднее, чем через 30~минут.
            Если, руководствуясь данными правилами, бот не может отправить пользователю рассылку
            более 24~часов, то допускается не отправлять данную рассылку этому пользователю в этот день.

        \subsubsection{Сервисные уведомления}
            \label{sec:req:fn:service}
            При возникновении определённых ситуаций, описанных в техническом задании,
            бот рассылает сервисные уведомления тем пользователям, которые на них подписаны и имеют
            право их получать. Сервисное уведомление представляет из себя одно сообщение с текстом
            не длиннее 3500~символов и не более, чем одним вложением.

            Каждое сервисное уведомление должно быть промаркировано хэштегом \hbox{\texttt{\#сервисное}}.
            Также применимы правила отправки рассылок пользователям в интерактивном состоянии,
            описанные в разделе \ref{sec:req:fn:newsletter}.

        \subsubsection{Управление подпиской на рассылки}
            \label{sec:req:fn:subscriptions}
            Любой пользователь имеет возможность подписаться, отписаться и проверить статус подписки на
            любые рассылки, доступные этому пользователю. Перечень рассылок, поддерживаемых ботом:
            \begin{enumerate}
                \item
                    Новостная рассылка, описанная в разделе \ref{sec:req:fn:newsletter}.
                    Доступна всем пользователям, по умолчанию подписка неактивна.
                \item
                    Рассылка сервисных уведомлений, описанная в разделе \ref{sec:req:fn:service}.
                    Доступна только пользователям, наделённых правом получения сервисных уведомлений,
                    подписка автоматически становится активна, когда пользователя в первый
                    раз наделяют необходимыми правами.
            \end{enumerate}

        \subsubsection{Управление правами пользователей}
            \label{seq:req:fn:roles}
            Пользователи, наделённые правами администратора, могут выдавать другим
            пользователям права и отзывать их. Также они могут редактировать свои права.
            Поддерживаемые права пользователей описаны в разделе \ref{sec:req:sec}.
            После любого редактирования прав пользователей должен остаться хотя бы один
            пользователь с правами администратора. Попытка изменения прав, не соблюдающая
            это ограничение, заканчивается ошибкой и отсутствием изменений в правах.

    \subsection{Требования к интерфейсу}
        \label{sec:req:ui}
        Интерфейс взаимодействия с ботом (отправка текста, изображений, видео и файлов)
        должен обеспечиваться стандартными средствами мессенджера.


    \subsection{Требования к безопасности}
        \label{sec:req:sec}
        \todo{Описание прав пользователей и управления ими.}

    \subsection{Требования к надёжности}
        \label{sec:req:reliab}
        \todo{Требования к обеспечению надёжного функционирования,
        контроль входных и выходных данных, время восстановления после отказа, etc.}

    \subsection{Условия эксплуатации}
        \label{sec:req:maint}
        \todo{Физические условия, вид обслуживания, количество и квалификация персонала для обслуживания}

    \subsection{Требования к составу и параметрам технических средств}
        \label{sec:req:hw}
        \todo{Требования к серверу (аппаратные и программные) и к клиентским приложениям для мессенджера}

    \subsection{Требования к информационной и программной совместимости}
        \label{sec:req:compat}
        \todo{Формат данных, методы решения, языки программирования, библиотеки, etc.}

    \subsection{Требования к маркировке и упаковке}
        \label{sec:req:ship}
        \todo{Поставка программы заказчику, взаимодействие пользователей с программой}

    \subsection{Требования к транспортированию и хранению}
        \label{sec:req:data}
        \todo{Условия хранения и передачи данных}

    \subsection{Специальные требования}
        \label{sec:req:etc}
        \todo{Другие требования при наличии}

\section{Требования к программной документации}
    \label{sec:doc}
    \todo{Предварительный состав документации, специальные требования к ней}

%\section{Технико-экономические показатели}
%    \todo{Экономическая эффективность, сравнение экономических показателей с аналогами}

\section{Стадии и этапы разработки}
    \label{sec:dev}
    \todo{Этапы разработки и их содержание}

\section{Порядок контроля и приёмки}
    \label{sec:test}
    \todo{Виды испытаний, другие требования к приёмке}

\end{document}
