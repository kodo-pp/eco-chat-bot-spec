\subsection{Требования к интерфейсу}
\label{sec:req:ui}
Интерфейс взаимодействия с ботом (отправка текста, изображений, видео и файлов)
должен обеспечиваться стандартными средствами мессенджера. В любой момент времени работы
бота пользователю доступны:
\begin{enumerate}
    \item
        История взаимодействия с ботом: сообщения, отправленные ботом и пользователем
        друг другу
    \item
        Состояние, в котором на текущий момент находится взаимодействие с ботом, определяемое
        по последнему сообщению, отправленному ботом\footnote{В данном документе встречаются формулировки
        <<состояние пользователя>>, <<состояние бота>> и <<состояние взаимодействия
        (между пользоватем и ботом)>>. Данные формулировки являются эквивалентными и имеют
        один и тот же смысл. Формулировка <<состояние бота>> всегда подразумевает конкретного пользователя,
        взаимодействующего с ботом, поскольку состояние не является глобальным: взаимодействие одного
        пользователя с ботом не влияет на состояние взаимодействия другого пользователя с этим ботом.}
    \item
        Доступные методы дальнейшего взаимодействия с ботом: поле для ввода текста и вложений
        и/или кнопки или ссылки с вариантами взаимодействия, нажатие на которые приведёт к передаче
        команды боту, в зависимости от текущего состояния взаимодействия
\end{enumerate}
В каждом состоянии пользователю доступен определённый набор действий, каждое из которых
приводит к ответу со стороны бота и переходу в другое или то же самое состояние.
Информация, отправляемая и принимаемая ботом зависит от текущего состояния и определяется в разделе
\ref{sec:req:ui:states}.

\subsubsection{Состояния взаимодействия пользователя с ботом}
    \label{sec:req:ui:states}
    \begingroup
    \newcommand{\action}[1]{\textit{#1}}%
    \newcommand{\state}[1]{\uline{#1}}%
    В данном разделе \action{курсивом} указаны действия пользователя, а \state{подчёркнутым текстом}
    --- состояния взаимодействия.

    Пользователь, который до этого не взаимодействовал с ботом, а также пользователь, который
    до этого \action{остановил} бота и ещё не \action{запустил} его вновь, начинают
    своё взаимодействие с ним в \hyperref[itm:req:ui:states:init]{\state{первоначальном}} состоянии.
    Дальнейшее взаимодействие происходит согласно списку состояний, указанному ниже.
    Если для какого-то состояния какой-то вариант ввода со стороны пользователя не указан в данном
    списке, бот должен в ответ на него отправить сообщение, объясняющее, что данный
    ввод некорректен и остаться в том же состоянии.

    Интерактивным называется состояние, в котором пользователь не находится в процессе выполнения
    какого-либо действия с ботом. Для каждого из перечисленных ниже состояний может быть указано,
    считается ли оно интерактивным или нет. Если для какого-то состояния такого указания нет,
    оно считается интерактивным.

    Форма --- это набор полей для заполнения пользователем.  Заполнение поля --- это нажатие на
    интерактивную кнопку или ссылку или отправка пользователем сообщения. При заполнении
    каждого поля формы пользователю доступны кнопки <<Назад>> (на всех шагах, кроме первого),
    возвращающая пользователя на предыдущий шаг, и <<Отменить заполнение формы>>, возвращающая
    пользователя в состояние, в котором он был до заполнения формы. Определены следующие типы
    полей формы и соответствующие действия пользователя по их заполнению:
    \begin{enumerate}
        \item
            Выбор из ограниченного числа вариантов.
            Пользователю доступны кнопки или ссылки с вариантами, на которые пользователь может нажать
            для выбора одного из этих вариантов.
        \item
            Число.
            Пользователь отправляет ответным сообщением без вложений целое неотрицательное число.
        \item
            Короткий текст.
            Пользователь отправляет ответным сообщением без вложений короткий текст (не длиннее 100 символов).
        \item
            Текст.
            Пользователь отправляет ответным сообщением без вложений текст не длиннее 3500 символов.
        \item
            Сообщение.
            Пользователь отправляет ответным сообщением, возможно, содержащим вложения, текст не длиннее 3500
            символов.
        \item
            Изображение.
            Пользователь отправляет ответным сообщением изображение (с такими же требованиями, как к вложению)
            без текста.
        \item
            Несколько изображений.
            Пользователь отправляет ответным сообщением от 1 до 10 изображений
            (с такими же требованиями, как к вложениям)
            без текста.
        \item
            Местоположение.
            Пользователь отправляет местоположение той или иной точки в ответном сообщении.
            Вместо него пользователь также может отправить короткий текст с адресом или координатами в
            свободной форме --- это сделано на случай невозможности или неудобств при отправке
            местоположения через клиент мессенджера.
    \end{enumerate}
    При неверном действии пользователя или неверном значении при заполнении поля бот сообщает пользователю
    об ошибке и остаётся на том же шаге заполнения формы. Если часть действия некорректна, но по своей сути
    оно допустимо (например, пользователь при заполнении поля с типом <<Изображение>> прислал изображение с
    описанием), бот может принять это за правильно заполненное поле с выводом предупреждения пользователю.
    Заполнение форм описывает некоторые состояния пользовательского интерфейса, о чём упомянуто в описании
    данных состояний.

    Список состояний, определяемых данным документом:
    \begin{enumerate}
        \item \label{itm:req:ui:states:init}
            \state{Первоначальное} состояние \\
            Состояние, в котором пользователь ещё не начал общение с ботом.
            Пользователю должна быть доступна кнопка с текстом <<Начать>>\footnote{
            Везде в этом документе, где указан текст элементов интерфейса, допускается
            использование другого текста с таким же смыслом, если это не повредит восприятию
            интерфейса пользователем.}, за исключением случаев, когда это технически невозможно.

            Любой ввод со стороны пользователя кроме отправки сообщений с одним или несколькими
            вложениями должен восприниматься ботом как \action{запуск} бота, при этом бот должен прислать
            сообщение с приветствием и кратким описанием своих функций, и перейти в состояние
            \hyperref[itm:req:ui:states:mainmenu]{\state{главного меню}}.
            Если же пользователь отправляет сообщение с одним или несколькими
            вложениями, бот должен отправить сообщение с объяснением, что он не готов принять вложения
            в данный момент, и что для того, чтобы начать работу с ботом, требуется \action{запустить}
            его. Состояние при этом не должно измениться.

            Данное состояние не считается интерактивным.

        \item \label{itm:req:ui:states:mainmenu}
            \state{Главное меню} \\
            Состояние, в котором пользователь оказывается непосредственно после \action{запуска}
            бота или после завершения какого-либо действия с ботом. Пользователю должны быть доступны
            следующие интерактивные кнопки или ссылки:
            \begin{itemize}
                \item
                    По одной кнопке на каждый закреплённый раздел и каждую закреплённую заметку.
                    При \action{нажатии} на кнопку закреплённого раздела пользователь переходит
                    в состояние
                    \hyperref[itm:req:ui:states:navx]
                    {\state{навигации по базе знаний в \placeholder{выбранном разделе}}}.
                    При \action{нажатии} на кнопку закреплённой заметки пользователь переходит
                    в состояние
                    \hyperref[itm:req:ui:states:view-note]
                    {\state{просмотра \placeholder{выбранной заметки}}}.
                    Кнопки доступны и видимы всем пользователям.
                \item
                    <<Все статьи>>
                    При \action{нажатии} на кнопку пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:navx]
                    {\state{навигации по базе знаний в корневом разделе}}.
                    Кнопка доступна и видима всем пользователям.
                \item
                    <<Архив рассылок>>
                    При \action{нажатии} на кнопку пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:navx]
                    {\state{навигации по базе знаний в разделе <<Архив рассылок>>}}.
                    Кнопка доступна и видима всем пользователям.
                \item
                    <<Календарь событий>>
                    При \action{нажатии} на кнопку пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:calendar]
                    {\state{просмотра календаря событий}}.
                    Кнопка доступна и видима всем пользователям.
                \item
                    <<Совместный сбор вторсырья>>
                    При \action{нажатии} на кнопку пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:gc]
                    {\state{просмотра страницы по совместному сбору вторсырья}}.
                    Кнопка доступна и видима всем пользователям.
                \item
                    <<Панель администратора>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:adminpanel]
                    {\state{работы с панелью администратора}}.
                    Кнопка доступна и видима пользователям, имеющим права администратора.
                \item
                    <<Подписки на рассылки>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:subscriptions]
                    {\state{управления подписками}}.
                    Кнопка доступна и видима всем пользователям.
                \item
                    <<Обратная связь>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:feedback]
                    {\state{обратной связи}}.
                    Кнопка доступна и видима всем пользователям.
                \item
                    <<Предложить экологическую инициативу>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:feedbackx]
                    {\state{обратной связи с темой <<Предложить экологическую инициативу>>}}.
                    Кнопка доступна и видима всем пользователям.
            \end{itemize}
            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:mainmenu} и рис.~\ref{fig:sketch:mainmenu-for-admins}.

            Данное состояние не считается интерактивным.

        \item \label{itm:req:ui:states:navx}
            \state{Навигация по базе знаний в разделе \(X\)}

            Состояние, в котором пользователь находится при перемещении по разделам
            базы знаний. Раздел \(X\) --- это любой существующий раздел в базе знаний (включая корневой).
            Пользователю должен выводиться полный путь к разделу (от корневого). Пример
            вывода пути ко вложенному разделу показан на рис.~\ref{fig:sketch:kb-pagination}.

            В интерфейсе должны быть перечислены все разделы и заметки, содержащиеся в разделе
            \(X\). При необходимости следует использовать постраничный вывод этой информации
            (не более 10 материалов на странице), давая пользователю возможность переключаться
            между страницами вывода. В таком случае необходимо указывать, сколько всего материалов
            в данном разделе и какие по номеру материалы отображаются в данный момент.
            Также пользователю должны быть доступны следующие интерактивные кнопки или ссылки:
            \begin{itemize}
                \item
                    <<Вверх>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:navx]
                    {\state{навигации по базе знаний в разделе \(Y\)}}, где \(Y\)
                    --- это родительский раздел \(X\) (т.е. раздел \(X\) принадлежит
                    разделу \(Y\)).
                    Кнопка доступна всем пользователям и видима, если текущий раздел
                    не является корневым.
                \item
                    <<В главное меню>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:mainmenu]
                    {\state{главного меню}}.
                    Кнопка доступна и видима всем пользователям.
                \item
                    <<Редактировать этот раздел>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:edit-section]
                    {\state{редактирования \placeholder{текущего раздела}}}.
                    Кнопка доступна и видима пользователям, имеющим право на редактирования базы знаний,
                    если текущий раздел не является виртуальным и не находится в виртуальном разделе.
                \item
                    По одной кнопке на каждый раздел и каждую заметку, содержащиеся в разделе \(X\).
                    При \action{нажатии} на кнопку раздела пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:navx]
                    {\state{навигации по базе знаний в \placeholder{выбранном разделе}}}.
                    При \action{нажатии} на кнопку заметки пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:view-note]
                    {\state{просмотра \placeholder{выбранной заметки}}}.
                    Кнопки доступны и видимы всем пользователям.
                \item
                    Прочие элементы интерфейса для организации постраничного вывода.
                    При \action{нажатии} пользователь переходит между страницами
                    вывода, не меняя состояния.
                    Кнопка доступна всем пользователям и видима, если полный
                    вывод не умещается на одну страницу.
                    Пример расположения таких элементов интерфейса показан
                    на рис.~\ref{fig:sketch:kb-pagination}.
            \end{itemize}
            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:kb-navigation-for-viewers} и
            рис.~\ref{fig:sketch:kb-navigation-for-editors}.

        \item \label{itm:req:ui:states:view-note}
            \state{Просмотр заметки \(X\)}

            Состояние, в котором пользователь имеет возможность прочитать текст и/или загрузить
            вложения определённой заметки. \(X\) может быть любой существующей заметкой.

            Бот отправляет пользователю одно или несколько сообщений (согласно правилам, указанным в
            данном техническом задании), в которых содержится следующая информация:
            \begin{itemize}
                \item
                    Название заметки
                \item
                    Текст заметки
                \item
                    Все вложения, принадлежащие данной заметке (при их наличии)
            \end{itemize}

            Пользователю должны быть доступны следующие интерактивные кнопки или ссылки:
            \begin{itemize}
                \item
                    <<Назад>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:navx]
                    {\state{навигации по базе знаний в разделе \(Y\)}}, где \(Y\)
                    --- это родительский раздел по отношению к заметке \(X\)
                    (т.е. заметка \(X\) принадлежит разделу \(Y\)).
                    Кнопка доступна и видима всем пользователям.
                \item
                    <<В главное меню>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:mainmenu]
                    {\state{главного меню}}.
                    Кнопка доступна и видима всем пользователям.
                \item
                    <<Редактировать>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:edit-note]
                    {\state{редактирования заметки}}.
                    Кнопка доступна и видима пользователям, имеющим право на редактирование базы знаний.
                \item
                    <<Переименовать>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:rename-kbo]
                    {\state{переименования материала}}.
                    Кнопка доступна и видима пользователям, имеющим право на редактирование базы знаний.
                \item
                    <<Переместить в другой раздел>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:move-kbo]
                    {\state{перемещения материала}}.
                    Кнопка доступна и видима пользователям, имеющим право на редактирование базы знаний.
                \item
                    <<Удалить>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:delete-kbo]
                    {\state{подтверждения удаления материала}}.
                    Кнопка доступна и видима пользователям, имеющим право на редактирование базы знаний.
                \item
                    <<Закрепить в главном меню>> или <<Открепить из главного меню>>.
                    При \action{нажатии} заметка становится закреплённой в главном меню или теряет этот
                    статус. Если при нажатии кнопки <<Закрепить в главном меню>> лимит на количество
                    закреплённых в главном меню материалов превышается, бот должен сообщить об
                    этом и не изменять статус заметки. В любом случае, состояние пользователя
                    не изменяется.
                    Кнопка доступна и видима пользователям, имеющим право на редактирование базы знаний.
            \end{itemize}

            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:kb-note-for-viewers} и
            рис.~\ref{fig:sketch:kb-note-for-editors}.

        \item \label{itm:req:ui:states:subscriptions}
            \state{Управление подписками}

            В данном состоянии пользователь видит список доступных ему рассылок и подписан ли
            он на каждую из них, а также может подписаться на какие-либо рассылки или отписаться
            от них.

            Для каждой доступной пользователю подписки должны выводиться
            следующие данные:
            \begin{itemize}
                \item
                    Название рассылки
                \item
                    Краткое описание рассылки
                \item
                    Статус подписки пользователя на эту рассылку (подписан или не подписан)
                \item
                    Кнопка или ссылка для подписки или отписки от данной рассылки
            \end{itemize}

            При \action{нажатии} на кнопку или ссылку для подписки на рассылку или отписки от неё
            бот должен прислать пользователю уведомление о соответствующем изменении в статусе
            его подписки.

            Также пользователю должна быть доступна кнопка или ссылка <<В главное меню>>.
            При \action{нажатии} пользователь переходит в состояние
            \hyperref[itm:req:ui:states:mainmenu]
            {\state{главного меню}}.

            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:subscriptions}.

        \item \label{itm:req:ui:states:adminpanel}
            \state{Работа с панелью администратора}

            В данном состоянии пользователю показывается меню действий, доступных администраторам.
            Пользователю должны быть доступны следующие интерактивные кнопки или ссылки:
            \begin{itemize}
                \item
                    <<В главное меню>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:mainmenu]
                    {\state{главного меню}}.
                \item
                    <<Права пользователей>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:user-privs]
                    {\state{управления правами пользователей}}.
            \end{itemize}

            Все кнопки доступны и видимы только администраторам.

            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:adminpanel}.

        \item \label{itm:req:ui:states:user-privs}
            \state{Управление правами пользователей}

            В данном состоянии пользователю показывается список всех пользователей
            имеющих специальные права (см. раздел~\ref{sec:req:sec:privs}), список прав каждого
            упомянутого пользователя, а также предоставляется
            возможность выдать пользователям права или отозвать их.
            Пользователю должны быть доступны следующие интерактивные кнопки или ссылки:
            \begin{itemize}
                \item
                    По одной кнопке или ссылке для управления правами каждого пользователя.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:user-privsx]
                    {\state{управлению правами \placeholder{выбранного пользователя}}}.
                \item
                    <<Выдать права другому пользователю>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:user-privs-unlisted]
                    {\state{управлению правами пользователя не из списка}}.
                \item
                    <<В главное меню>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:mainmenu]
                    {\state{главного меню}}.
                \item
                    <<В панель администратора>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:adminpanel]
                    {\state{панели администратора}}.
            \end{itemize}

            Все кнопки доступны и видимы только администраторам.

            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:privs}.

        \item \label{itm:req:ui:states:user-privsx}
            \state{Управление правами пользователя \(X\)}

            В данном состоянии пользователю показывается список прав, которые имеет пользователь \(X\)
            и предоставляется возможность выдать ему права или отозвать их.
            Пользователю должны быть доступны следующие интерактивные кнопки или ссылки:
            \begin{itemize}
                \item
                    <<Запретить/Разрешить редактирование базы знаний>>
                    (в зависимости от текущего набора прав).
                    При \action{нажатии} отзывает или выдаёт пользователю \(X\) право на редактирование
                    базы знаний. Состояние не меняется.
                \item
                    <<Запретить/Разрешить получение сервисных уведомлений>>
                    (в зависимости от текущего набора прав).
                    При \action{нажатии} отзывает или выдаёт пользователю \(X\) право на получение
                    сервисных уведомлений. Состояние не меняется.
                \item
                    <<Запретить/Разрешить получение обратной связи>>
                    (в зависимости от текущего набора прав).
                    При \action{нажатии} отзывает или выдаёт пользователю \(X\) право на получение
                    обратной связи. Состояние не меняется.
                \item
                    <<Сделать администратором / Отозвать статус администратора>>
                    (в зависимости от текущего набора прав).
                    При \action{нажатии} отзывает или выдаёт пользователю \(X\) статус администратора.
                    Состояние не меняется. Если статус отозвать невозможно из-за нарушения ограничений,
                    указанных в этом документе, бот сообщает пользователю об ошибке и не изменяет
                    права пользователя \(X\).
                \item
                    <<Назад>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:user-privs]
                    {\state{управления правами пользователей}}.
            \end{itemize}

            Все кнопки доступны и видимы только администраторам.

            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:privs}.

        \item \label{itm:req:ui:states:user-privs-unlisted}
            \state{Управление правами пользователя не из списка}

            В данном состоянии можно управлять правами пользователя, не указанного в списке,
            описанном в состоянии
            \hyperref[itm:req:ui:states:user-privs]
            {\state{управления правами пользователей}}.
            Для этого пользователь должен отправить боту сообщение с указанием пользователя,
            к которому нужно применить изменения.
            Пользователю должны быть доступны следующие интерактивные кнопки или ссылки:
            \begin{itemize}
                \item
                    <<Назад>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:user-privs]
                    {\state{управления правами пользователей}}.
            \end{itemize}

            Все кнопки доступны и видимы только администраторам.

            Если перед этим не были совершены другие действия, то сообщение от пользователя
            в одном из форматов, указанных ниже, должно быть принято в качестве идентификационной
            информации другого пользователя. Если пользователь не может быть найден по такой
            идентификационной информации, бот выдаёт сообщение об ошибке и не меняет состояние.
            В случае успеха пользователь переходит в состояние
            \hyperref[itm:req:ui:states:user-privsx]
            {\state{управления правами \placeholder{указанного пользователя}}}.

            Возможные форматы сообщения с идентификационной информацией:
            \begin{itemize}
                \item
                    \texttt{\emph{username}}
                \item
                    \texttt{@\emph{username}}
                \item
                    \texttt{id:\emph{code}}
            \end{itemize}
            Здесь \texttt{\emph{username}} --- это строка с именем пользователя, а
            \texttt{\emph{code}} --- это числовой идентификатор пользователя. Подробнее
            об идентификации пользователей написано в разделе~\ref{sec:req:sec:id}.

            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:privs}.

        \item \label{itm:req:ui:states:feedback}
            \state{Обратная связь}

            В данном состоянии пользователь может выбрать тему обратной связи.
            Пользователю должны быть доступны следующие интерактивные кнопки или ссылки:
            \begin{itemize}
                \item
                    <<В главное меню>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:mainmenu]
                    {\state{главного меню}}.
                    Кнопка доступна и видима всем пользователям.
                \item
                    По одной кнопке для каждой доступной темы обратной связи
                    (см. раздел~\ref{sec:req:fn:feedback}).
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:feedbackx]
                    {\state{обратной связи с \placeholder{выбранной темой}}}.
                    Кнопка доступна и видима всем пользователям.
            \end{itemize}

            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:feedback}.

        \item \label{itm:req:ui:states:feedbackx}
            \state{Обратная связь с темой \(X\)}

            В данном состоянии пользователь заполняет форму в зависимости от выбранной темы
            обратной связи.
            Если выбранная тема обратной связи --- <<Сообщить о несанкционированной свалке>>,
            то заполняется следующая форма:
            \begin{itemize}
                \item
                    ФИО (короткий текст)
                \item
                    Местоположение свалки (местоположение)
                \item
                    Контактный телефон (короткий текст в формате телефона)
                \item
                    Контактный email при наличии (короткий текст в формате email)
                \item
                    Подробности (сообщение)
            \end{itemize}

            В ином случае заполняется следующая форма:
            \begin{itemize}
                \item
                    ФИО (короткий текст)
                \item
                    Обратная связМестоположение (сообщение)
            \end{itemize}

            После заполнения формы пользователь переходит в состояние
            \hyperref[itm:req:ui:states:mainmenu]
            {\state{главного меню}}.

            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:feedback}.

        \item \label{itm:req:ui:states:edit-note}
            \state{Редактирование заметки}

            В данном состоянии пользователь может отправить сообщение с новым содержимым
            заметки, а также указать, что делать с существующими вложениями.
            Пользователю должны быть доступны следующие интерактивные кнопки или ссылки:
            \begin{itemize}
                \item
                    <<Сохранить существующие вложения>> или <<Не сохранять существующие вложения>>.
                    При \action{нажатии} переключается поведение существующих вложений: при настройке
                    <<сохранить>> они будут сохранены, а новые вложения (при наличии)
                    --- добавлены к ним (при условии соблюдения лимита на количество вложений);
                    при настройке <<не сохранять>> существующие вложения будут удалены, а новые
                    вложения (при наличии) их заменят.
                    В любом случае, состояние пользователя не изменяется.
                    Кнопка доступна и видима всем пользователям. Текст варьируется в зависимости от
                    текущей настройки: <<Сохранить существующие вложения>> показывается, когда настройка
                    выставлена в положение <<не сохранять>>, и наоборот.
                \item
                    <<Назад>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:view-note]
                    {\state{просмотра \placeholder{текущей заметки}}}.
                    Кнопка доступна и видима всем пользователям.
            \end{itemize}

            Если перед этим не были совершены другие действия, то любое сообщение от пользователя,
            возможно, включающее вложения, должно быть принято в качестве нового содержимого заметки,
            если оно не нарушает установленные в этом документе лимиты. В случае успеха
            пользователь переходит в состояние
            \hyperref[itm:req:ui:states:view-note]
            {\state{просмотра \placeholder{текущей заметки}}}.

            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:edit-note}.

        \item \label{itm:req:ui:states:edit-section}
            \state{Редактирование раздела}

            В данном состоянии пользователь может изменить имя, расположение и содержимое не-виртуального
            раздела.
            Пользователю должны быть доступны следующие интерактивные кнопки или ссылки:
            \begin{itemize}
                \item
                    <<Создать заметку>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:create-note]
                    {\state{создания заметки}}.
                \item
                    <<Создать подраздел>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:create-section]
                    {\state{создания раздела}}.
                \item
                    <<Переименовать>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:rename-kbo]
                    {\state{переименования материала}}.
                \item
                    <<Переместить в другой раздел>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:move-kbo]
                    {\state{перемещения материала}}.
                \item
                    <<Удалить>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:delete-kbo]
                    {\state{удаления материала}}.
                \item
                    <<Закрепить в главном меню>> или <<Открепить из главного меню>>.
                    При \action{нажатии} раздел становится закреплённым в главном меню или теряет этот
                    статус. Если при нажатии кнопки <<Закрепить в главном меню>> лимит на количество
                    закреплённых в главном меню материалов превышается, бот должен сообщить об
                    этом и не изменять статус раздела. В любом случае, состояние пользователя
                    не изменяется.
                \item
                    <<Назад>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:navx]
                    {\state{навигации по базе знаний в \placeholder{текущем разделе}}}.
                    Кнопка доступна и видима всем пользователям.
            \end{itemize}

            Все кнопки доступны и видимы только пользователям, имеющим право на редактирование
            базы знаний.

            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:edit-section}.

        \item \label{itm:req:ui:states:rename-kbo}
            \state{Переименование материала}

            В данном состоянии пользователь может отправить сообщение с новым именем для
            текущей заметки или текущего раздела, чтобы переименовать эту заметку или этот раздел.
            Пользователю должны быть доступны следующие интерактивные кнопки или ссылки:
            \begin{itemize}
                \item
                    <<Назад>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:navx]
                    {\state{навигации по базе знаний в \placeholder{текущем разделе}}}.
                    Кнопка доступна и видима всем пользователям.
            \end{itemize}
            Если перед этим не были совершены другие действия, то сообщение от пользователя
            с новым названием раздела или заметки без вложений должно быть принято,
            и раздел или заметка должны быть переименованы соответствующим образом,
            если данное имя допустимо.
            В случае успеха пользователь переходит в состояние
            \hyperref[itm:req:ui:states:navx]
            {\state{навигации по базе знаний в \placeholder{текущем разделе}}}.

            Все кнопки и действия доступны и видимы только пользователям, имеющим право на редактирование
            базы знаний.

        \item \label{itm:req:ui:states:move-kbo}
            \state{Перемещение материала (текущий раздел \(X\))}

            Состояние, в котором пользователь выбирает раздел, в который следует переместить
            выбранную заметку или раздел, и сейчас находится в разделе \(X\).
            Раздел \(X\) --- это любой существующий раздел в базе знаний (включая корневой).
            Пользователю должен выводиться полный путь к разделу (от корневого). Пример
            вывода пути ко вложенному разделу показан на рис.~\ref{fig:sketch:kb-pagination}.
            При соблюении остальных требований данного пункта, интерфейс в данном состоянии
            должен быть как можно более похожим стилистически и визуально на интерфейс
            в состоянии
            \hyperref[itm:req:ui:states:navx]
            {\state{навигации по базе знаний в разделе \(X\)}}.

            В интерфейсе должны быть перечислены все разделы, содержащиеся в разделе
            \(X\). При необходимости следует использовать постраничный вывод этой информации
            (не более 10 элементов на странице), давая пользователю возможность переключаться
            между страницами вывода. В таком случае необходимо указывать, сколько всего подразделов
            в данном разделе и какие по номеру подраздел отображаются в данный момент.
            Также пользователю должны быть доступны следующие интерактивные кнопки или ссылки:
            \begin{itemize}
                \item
                    <<Вверх>>, по одной кнопке на каждый подраздел, а также
                    элементы интерфейса для организации потраничного вывода при необходимости.
                    Кнопки работают аналогично соответствующим кнопкам из состояния 
                    \hyperref[itm:req:ui:states:navx]
                    {\state{навигации по базе знаний в разделе \(X\)}}, за исключением того,
                    что вместо состояния
                    \hyperref[itm:req:ui:states:navx]
                    {\state{навигации по базе знаний в разделе \(Y\)}}.
                    текущее состояние меняется на состояние
                    \hyperref[itm:req:ui:states:move-kbo]
                    {\state{перемещения материала (текущий раздел \(Y\))}}.
                \item
                    <<Отменить перемещение>>.
                    При \action{нажатии} процесс перемещения материала отменяется.
                    Пользователь возвращается в состояние
                    \hyperref[itm:req:ui:states:navx]
                    {\state{навигации по базе знаний в разделе \(X\)}}.
                \item
                    <<Переместить сюда>>.
                    При \action{нажатии} бот перемещает выбранный материал в выбранный раздел,
                    и сообщает пользователю о результате операции. В любом случае, пользователь
                    переходит в состояние
                    \hyperref[itm:req:ui:states:navx]
                    {\state{навигации по базе знаний в разделе \(N\)}}.
                    В случае успешного перемещения раздел \(N\) --- это перемещённый раздел
                    в новом месте. В случае неуспешного перемещения раздел \(N\) --- это раздел \(X\)
                    без каких-либо изменений.
            \end{itemize}

            Все кнопки доступны и видимы только пользователям, имеющим право на редактирование базы
            знаний.

            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:move-note}.


        \item \label{itm:req:ui:states:delete-kbo}
            \state{Подтверждение удаления материала}

            В данном состоянии пользователь подтверждает или отменяет удаление выбранного
            материала. Пользователю обязательно должен отображаться полный путь к материалу
            на удаление.
            \begin{itemize}
                \item
                    <<Удалить>>.
                    При \action{нажатии} выбранный материал (и все вложенные в него материалы,
                    если это раздел) удаляются из базы знаний без штатной возможности восстановления.
                    При возникновении ошибки бот должен вывести её пользователю и немеденно прервать
                    операцию удаления.
                    При успешном удалении пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:navx]
                    {\state{навигации по базе знаний в разделе \(Y\)}},
                    где \(Y\) --- это раздел, в котором непосредственно содержался удалённый раздел.
                    При ошибке удаления пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:navx]
                    {\state{навигации по базе знаний в \placeholder{текущем разделе}}}.
                \item
                    <<Не удалять>>.
                    При \action{нажатии} операция удалений материала отменяется.
                    Пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:navx]
                    {\state{навигации по базе знаний в \placeholder{текущем разделе}}}.
            \end{itemize}

            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:delete-note} и рис.~\ref{fig:sketch:delete-section}.

        \item \label{itm:req:ui:states:create-note}
            \state{Создание заметки}

            В данном состоянии пользователь начинает процесс создания новой заметки и может
            отправить сообщение с именем создаваемой заметки.

            Также пользователю должны быть доступны следующие интерактивные кнопки или ссылки:
            \begin{itemize}
                \item
                    <<Назад>>.
                    При \action{нажатии} пользователь отменяет создание заметки и
                    переходит в состояние
                    \hyperref[itm:req:ui:states:navx]
                    {\state{навигации по базе знаний в \placeholder{текущем разделе}}}.
            \end{itemize}
            
            Если перед этим не были совершены другие действия, то сообщение от пользователя
            с названием новой заметки без вложений должно быть принято ботом, и
            состояние взаимодействия должно измениться на
            \hyperref[itm:req:ui:states:create-notex]
            {\state{создание заметки с названием \placeholder{из этого сообщения}}}.

            Все кнопки и действия доступны и видимы только пользователям, имеющим право на редактирование
            базы знаний.

            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:add-note}.

        \item \label{itm:req:ui:states:create-notex}
            \state{Создание заметки с названием \(X\)}

            В данном состоянии пользователь продолжает процесс создания новой заметки и может
            отправить сообщение с содержанием заметки.

            Также пользователю должны быть доступны следующие интерактивные кнопки или ссылки:
            \begin{itemize}
                \item
                    <<Назад>>.
                    При \action{нажатии} пользователь возвращается к шагу выбора имени для заметки
                    в состояние
                    \hyperref[itm:req:ui:states:create-note]
                    {\state{создания заметки}}.
            \end{itemize}
            
            Если перед этим не были совершены другие действия, то сообщение от пользователя
            с должно быть принято ботом, и новая заметка должна сохраниться.
            Бот должен сообщить пользователю об успехе или ошибке операции, и
            состояние взаимодействия должно измениться на состояние
            \hyperref[itm:req:ui:states:navx]
            {\state{навигации по базе знаний в \placeholder{текущем разделе}}}.

            Все кнопки и действия доступны и видимы только пользователям, имеющим право на редактирование
            базы знаний.

            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:add-note}.

        \item \label{itm:req:ui:states:create-section}
            \state{Создание раздела}

            В данном состоянии пользователь может отправить сообщение с именем раздела и таким образом
            создать пустой раздел с выбранным именем.

            Также пользователю должны быть доступны следующие интерактивные кнопки или ссылки:
            \begin{itemize}
                \item
                    <<Назад>>.
                    При \action{нажатии} пользователь отменяет создание раздела и
                    переходит в состояние
                    \hyperref[itm:req:ui:states:navx]
                    {\state{навигации по базе знаний в \placeholder{текущем разделе}}}.
            \end{itemize}
            
            Если перед этим не были совершены другие действия, то сообщение от пользователя
            с названием новой заметки без вложений должно быть принято ботом, и
            бот должен создать в текущем разделе пустой подраздел с таким именем.
            Об успехе или ошибке операции необходимо сообщить пользователю.
            После выполнения операции состояние должно измениться на
            состояние \hyperref[itm:req:ui:states:navx]
            {\state{навигации по базе знаний в \placeholder{текущем разделе}}}.

            Все кнопки и действия доступны и видимы только пользователям, имеющим право на редактирование
            базы знаний.

            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:add-section}.

        \item \label{itm:req:ui:states:calendar}
            \state{Просмотр календаря событий}

            В данном состоянии пользователь может просмотреть список событий, имеющихся в календаре событий.
            Если пользователь обладает правом на управление событиями, он также может изменить или удалить
            события, а также добавить новые.

            Пользователю должны быть доступны следующие интерактивные кнопки или ссылки:
            \begin{itemize}
                \item
                    <<В главное меню>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:mainmenu]
                    {\state{главного меню}}.
                    Кнопка доступна и видима всем пользователям.
                \item
                    <<Добавить событие>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:create-event]
                    {\state{создания события}}.
                    Кнопка доступна и видима пользователям, имеющим право на управление событиями.
                \item
                    По одной кнопке или ссылке для каждого события.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:view-event]
                    {\state{просмотра события}}.
                    Кнопка доступна и видима всем пользователям.
            \end{itemize}

            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:calendar}.

        \item \label{itm:req:ui:states:view-event}
            \state{Просмотр события}

            В данном состоянии пользователь может просмотреть подробности события из календаря событий
            (название, описание, дата и время). Если пользователь имеет право на управление событиями,
            он также может реактировать или удалить событие.

            Пользователю должны быть доступны следующие интерактивные кнопки или ссылки:
            \begin{itemize}
                \item
                    <<Переименовать>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:rename-event]
                    {\state{переименования события}}.
                    Кнопка доступна и видима пользователям, имеющим право на управление событиями.
                \item
                    <<Изменить дату и время>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:edit-event-date]
                    {\state{изменения даты и времени события}}.
                    Кнопка доступна и видима пользователям, имеющим право на управление событиями.
                \item
                    <<Редактировать описание события>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:edit-event-desc]
                    {\state{редактирования описания события}}.
                    Кнопка доступна и видима пользователям, имеющим право на управление событиями.
                \item
                    <<Удалить>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:delete-event]
                    {\state{подтверждения удаления события}}.
                    Кнопка доступна и видима пользователям, имеющим право на управление событиями.
                \item
                    <<Назад>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:calendar]
                    {\state{календаря событий}}.
                    Кнопка доступна и видима всем пользователям.
                \item
                    <<В главное меню>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:mainmenu]
                    {\state{главного меню}}.
                    Кнопка доступна и видима всем пользователям.
            \end{itemize}

            Пример возможного расположения элементов пользовательского интерфейса показан на
            рис.~\ref{fig:sketch:event}.

        \item
            \label{itm:req:ui:states:rename-event}
            \state{Переименование события},
            \label{itm:req:ui:states:edit-event-date}
            \state{изменение даты и времени события},
            \label{itm:req:ui:states:edit-event-desc}
            \state{редактирование описания события},
            \label{itm:req:ui:states:delete-event}
            \state{подтверждение удаления события},
            \label{itm:req:ui:states:create-event}
            \state{создание события}
            и вспомогательные состояния.
            Состояния описываются по аналогии с другими состояниями, подразумевающими переименование,
            редактирование, создание и удаление объектов, а также согласно соответствующим макетам интерфейса
            из раздела \ref{sec:sketch}.

        \item \label{itm:req:ui:states:gc}
            \state{Просмотр страницы по совместному сбору вторсырья}.
            В данном состоянии пользователю выводятся все точки совместного сбора вторсырья,
            доступные на данный момент. Выводится вся информация о них: инициатор,
            место и время окончания сбора.
            Также пользователю доступны следующие кнопки или ссылки:
            \begin{itemize}
                \item
                    <<В главное меню>>.
                    При \action{нажатии} пользователь переходит в состояние
                    \hyperref[itm:req:ui:states:mainmenu]
                    {\state{главного меню}}.
                    Кнопка доступна и видима всем пользователям.
                \item
                    <<Объявить о сборе отходов>>.
                    При \action{нажатии} пользователь заполняет форму со следующими полями:
                    \begin{itemize}
                        \item
                            Имя и фамилия (короткий текст)
                        \item
                            Место точки сбора (короткий текст)
                        \item
                            Время окончания сбора (короткий текст в формате ЧЧ:ММ).
                    \end{itemize}
                    Кнопка доступна и видима всем пользователям. После заполнения формы
                    пользователь возвращается в состояние
                    \hyperref[itm:req:ui:states:gc]
                    {\state{просмотра страницы по совместному сбору вторсырья}}.
            \end{itemize}
    \end{enumerate}

    При слишком долгом нахождении в каком-либо интерактивном состоянии без какой-либо активности
    со стороны пользователя, взаимодействие с ним автоматически переходит в состояние
    \hyperref[itm:req:ui:states:mainmenu]
    {\state{главного меню}}, при этом отменяются все начатые, но не завершённые операции.
    Время, которое должно пройти с момента последней активности пользователя до
    автоматического перехода в главное меню называется временем ожидания. Во всех интерактивных
    состояниях время ожидания составляет один час (3600~секунд), со следующими исключениями:
    \begin{itemize}
        \item
            В состоянии
            \hyperref[itm:req:ui:states:edit-note]
            {\state{редактирования заметки}}
            время ожидания состовляет 6~часов
        \item
            В состоянии
            \hyperref[itm:req:ui:states:create-note]
            {\state{создания заметки с именем \(X\)}}
            время ожидания состовляет 6~часов
    \end{itemize}
    \endgroup
